<label (click)="toggleDropdown($event)" class="form-label">{{ label | observableString }}</label>
<div class="dropdown-container" [ngClass]="{ 'ng-invalid': control?.invalid, 'ng-valid': control?.valid }">
  <div class="dropdown">
    <button
      #dropdownToggle
      (blur)="onTouched(); ngyBlur.emit($event)"
      (focus)="ngyFocus.emit($event)"
      (contextmenu)="ngyContextMenu.emit($event)"
      (click)="toggleDropdown($event);ngyClick.emit($event)"
      [disabled]="disabled"
      [ngClass]="{ 'ng-invalid': control?.invalid, 'ng-valid': control?.valid }"
      class="form-select d-flex w-100 justify-content-between align-items-center "
      type="button">
      <span class="text-truncate">{{ labels$ | observableString }}</span>
      <div>&nbsp;</div>
    </button>
    <div #dropdownMenu [id]="id + '_' + key"
         class="dropdown-menu shadow-sm w-100"
         [ngStyle]="{'--ngy-dropdown-max-height': maxHeight}"
         role="menu">
      <div class="d-flex flex-column align-items-stretch">
        <ng-container *ngIf="multiple">
          <label
            *ngFor="let option of _options"
            class="select-list-item hstack align-items-center gap-2 flex-fill py-2 ps-3 pe-2">
            <input
              (change)="changeCheckControl($event, option)"
              [checked]="valIncludes($any(val),option.value)"
              [disabled]="disabled"
              [value]="option.value"
              class="form-check-input m-0"
              type="checkbox"/>
            <span>{{ option.label | observableString }}</span>
          </label>
        </ng-container>

        <ng-container *ngIf="!multiple">
          <button
            (click)="clickedControl(option.value, option.label)"
            *ngFor="let option of _options"
            class="dropdown-item"
            type="button">
            {{ option.label | observableString }}
          </button>
        </ng-container>
      </div>
    </div>
  </div>

</div>

<ng-container *ngIf="helperTextTemplate && helperTextTemplate.templateRef">
  <div class="form-text">
    <ng-container [ngTemplateOutlet]="helperTextTemplate.templateRef"/>
  </div>
</ng-container>

<ng-container *ngIf="validatorsMessage && validatorsMessage.length > 0">
  <div class="ngy-invalid-feedback small">
    <ng-container *ngFor="let directive of validatorsMessage">
      <div *ngIf="control?.errors?.[directive.ngyValidatorMessage]">
        <ng-container [ngTemplateOutlet]="directive.templateRef"/>
      </div>
    </ng-container>
  </div>
</ng-container>
